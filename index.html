<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Santa's Village Advent Calendar</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lobster&display=swap" rel="stylesheet">
    <style>
        html {
            scrollbar-width: none;
        }
        body {
            font-family: 'Lobster', cursive;
            background-color: #4c1d95;
            background-image:
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            background-position: 0 0, 40px 60px, 130px 270px;
            overflow-x: hidden;
            -ms-overflow-style: none;
        }
        body::-webkit-scrollbar {
            display: none;
        }
        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            animation-name: fall;
            animation-timing-function: linear;
            animation-iteration-count: infinite;
            z-index: 0;
            pointer-events: none;
        }
        @keyframes fall {
            to { transform: translateY(100vh); }
        }
        .bg-card-blue { background-color: #4285f4; }
        .bg-card-green { background-color: #0f9d58; }
        .bg-card-red { background-color: #db4437; }
        .bg-card-yellow { background-color: #f4b400; }
        .bg-card-purple { background-color: #ab47bc; }
        .bg-card-teal { background-color: #00acc1; }
        .bg-card-locked { background-color: #475569; }
        .card-hover-effect {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .card-hover-effect:hover {
            transform: translateY(-8px);
            z-index: 10;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .locked-overlay {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: grayscale(100%);
        }
        .countdown-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 50;
            background-color: #ef4444;
            border-radius: 15px;
            padding: 8px 15px;
            display: flex;
            gap: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255,255,255,0.3);
            font-family: 'Lobster', cursive;
            transform: none;
        }
        .countdown-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .countdown-number {
            font-size: 1.2rem;
            color: white;
            line-height: 1;
        }
        .countdown-label {
            font-size: 0.6rem;
            color: rgba(255,255,255,0.9);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 2px;
        }
        .countdown-separator {
            width: 1px;
            background-color: rgba(255,255,255,0.3);
            height: 25px;
            align-self: center;
        }
        #start-audio-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            background-color: #db4437;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-family: 'Lobster', cursive;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: transform 0.2s, background-color 0.2s;
            animation: bounce 2s infinite;
        }
        #start-audio-btn:hover {
            transform: scale(1.1);
            background-color: #c53929;
        }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        #game-modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0,0,0,0.9);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #game-modal.active {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            /* Note: width/height were removed here as they are now controlled by the parent div class for responsiveness */
            background: white;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            box-shadow: 0 0 50px rgba(255,255,255,0.2);
            width: 100%; /* Ensure content fills the new larger parent */
            height: 100%;
        }
        /* MODIFICATION: Smaller, internal close button */
        .close-btn {
            position: absolute;
            top: 15px; /* Position inside the corner */
            right: 15px; /* Position inside the corner */
            background: #ef4444;
            color: white;
            width: 36px; /* Smaller size */
            height: 36px; /* Smaller size */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px; /* Smaller 'x' */
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.5);
            border: 2px solid white; /* Thinner border */
            z-index: 10000;
            transition: transform 0.2s, background-color 0.2s;
        }
        .close-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background-color: #c53929;
        }
        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        .hidden { display: none !important; }
        @media (max-width: 768px) {
            .countdown-container {
                position: relative;
                top: 0;
                left: 0;
                margin: 0 auto 20px auto;
                width: fit-content;
            }
        }
    </style>
</head>
<body class="min-h-screen py-10 px-4">
    <div id="snow-container"></div>
    <div class="countdown-container">
        <div class="countdown-item">
            <span class="countdown-number" id="days">00</span>
            <span class="countdown-label">Days</span>
        </div>
        <div class="countdown-separator"></div>
        <div class="countdown-item">
            <span class="countdown-number" id="hours">00</span>
            <span class="countdown-label">Hrs</span>
        </div>
        <div class="countdown-separator"></div>
        <div class="countdown-item">
            <span class="countdown-number" id="minutes">00</span>
            <span class="countdown-label">Min</span>
        </div>
        <div class="countdown-separator"></div>
        <div class="countdown-item">
            <span class="countdown-number" id="seconds">00</span>
            <span class="countdown-label">Sec</span>
        </div>
    </div>
    <button id="start-audio-btn">ðŸ”Š Click to Enable Sound</button>
    <header class="max-w-7xl mx-auto mb-10 text-center text-white relative z-10">
        <h1 class="text-5xl md:text-6xl mb-2 drop-shadow-md">Santa's Village ðŸŽ…</h1>
        <p class="text-white/80 text-xl">Advent Calendar: One surprise every day!</p>
    </header>
    <main class="max-w-[1400px] mx-auto relative z-10">
        <div id="grid-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4 md:gap-6">
        </div>
    </main>
    <div id="game-modal">
        <!-- MODIFICATION: Increased size to w-[95%] h-[95%] -->
        <div class="relative w-[95%] h-[95%]">
            <button class="close-btn" onclick="closeGameModal()">âœ•</button>
            <div class="modal-content">
                <iframe id="game-iframe" src=""></iframe>
            </div>
            <div class="text-white text-center mt-4 font-sans text-sm opacity-70">
                <p>If the game doesn't load here, <a id="fallback-link" href="#" target="_blank" class="underline text-yellow-300">click here to open in a new tab</a>.</p>
            </div>
        </div>
    </div>
    <script>
        const baseUrl = "https://maps.gstatic.com/mapfiles/santatracker/v202502142154/img/card/";
        const targetBaseUrl = "https://santatracker.google.com/";
        const audioBaseUrl = "https://maps.gstatic.com/mapfiles/santatracker/v202502142154/audio/";
        function createSnow() {
            const container = document.getElementById('snow-container');
            const snowflakeCount = 50;
            for (let i = 0; i < snowflakeCount; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.textContent = 'â„';
                flake.style.left = Math.random() * 100 + 'vw';
                flake.style.opacity = Math.random();
                flake.style.fontSize = (Math.random() * 10 + 10) + 'px';
                flake.style.animationDuration = (Math.random() * 3 + 2) + 's';
                flake.style.animationDelay = (Math.random() * 5) + 's';
                container.appendChild(flake);
            }
        }
        createSnow();
        function updateCountdown() {
            const now = new Date();
            const currentYear = now.getFullYear();
            let target = new Date(currentYear, 11, 24, 10, 0, 0);
            if (now > target) {
                target = new Date(currentYear + 1, 11, 24, 10, 0, 0);
            }
            const diff = target - now;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById('days').innerText = String(days).padStart(2, '0');
            document.getElementById('hours').innerText = String(hours).padStart(2, '0');
            document.getElementById('minutes').innerText = String(minutes).padStart(2, '0');
            document.getElementById('seconds').innerText = String(seconds).padStart(2, '0');
        }
        setInterval(updateCountdown, 1000);
        updateCountdown();
        const bgMusicUrl = audioBaseUrl + "13662_e6c0afaf321aaabf55f4f835eddd1cb3_music_village_lounge_r5.ogg";
        const sfxMap = {
            "boatload.json": "14893_3b5867eb47b29ea17b382fb4e06b1d62_menu_boatload_over_r1.ogg",
            "runner.json": "14835_2584770c7c57b441d09c3c8337f56b03_menu_runner_over.ogg",
            "glider.json": "14880_7e0e15223c012c1483edcb3fcc8b69d0_menu_glider_over_r1.ogg",
            "presentbounce.json": "14843_bfb1935e73d77258e7d9186e3478507d_menu_presentbounce_over.ogg",
            "codeboogie.json": "14852_e0ed9876e5e75af63fe44861724c580e_menu_codeboogie_over.ogg",
            "jetpack.json": "14851_a7bf4c951b5474b4eccca79295718aac_menu_jetpack_over.ogg",
            "jamband.json": "14850_feabe8931f6e614b35ab55f3cc798d75_menu_jamband_over.ogg",
            "snowball.json": "14849_2df7dd9b2f5a60d994fd82332ff906b5_menu_snowball_over.ogg",
            "elfmaker.json": "14891_b8a96bb8ebfa6bae7c1511a3e19fe7b7_menu_elfmaker_over_r3.ogg",
            "penguindash.json": "14846_a1f27d0f6308ffd06423aeda05d03004_menu_penguindash_over.ogg",
            "wrapbattle.json": "14845_6da885f6b728ff7ed0507ee9558ee49f_menu_wrapbattle_over.ogg",
            "gumball.json": "14844_ced8f6c38fce0f375e0edc05d21d1908_menu_gumball_over.ogg",
            "speedsketch.json": "14874_fb7834740c99d4e8f161653b9595fd96_menu_draw_over_r1.ogg",
            "santascanvas.json": "14876_ebaea47bd372fd7f4e604ebe546d681c_menu_canvas_over_r1.ogg",
            "seasonofgiving.json": "14875_83c155edbaddd55d52406a45721249af_menu_giving_over_r1.ogg",
            "traditions.json": "14897_4ce0b3d819b50b7e46980452d35fd528_menu_traditions_over_r3.ogg",
            "santasearch.json": "14837_6f2903285785ec64b14ce72ce91efc63_menu_santasearch_over.ogg",
            "translations.json": "14878_c9437412ce9c373115d653b2d0512ae9_menu_translations_over_r1.ogg",
            "snowbox.json": "14834_06b4cd49ac0e8b0c51c672cd5e464063_menu_snowbox_over.ogg",
            "buildandbolt.json": "14833_6336433dcd6537d9510b733666671ba6_menu_buildbolt_over.ogg",
            "mercator.json": "14832_8321f995e55977aa5309518f8b71bdaf_menu_mapquiz_over.ogg",
            "santaselfie.json": "14870_b62a69dbcb74af952803cdeab689ac0c_menu_selfie_over.ogg",
            "windtunnel.json": "14830_2d4caf043407c875cd59c233a3915816_menu_generic_over.ogg"
        };
        const bgAudio = new Audio(bgMusicUrl);
        bgAudio.volume = 0.4;
        let isAudioEnabled = false;
        const btn = document.getElementById('start-audio-btn');
        btn.addEventListener('click', () => {
            bgAudio.play().then(() => {
                isAudioEnabled = true;
                btn.classList.add('hidden');
            }).catch(e => console.log("Audio prevent", e));
        });
        bgAudio.addEventListener('timeupdate', () => {
            const timeLeft = bgAudio.duration - bgAudio.currentTime;
            if (timeLeft < 2.5 && timeLeft > 0) {
                if (bgAudio.volume > 0.05) {
                    bgAudio.volume -= 0.01;
                }
            }
        });
        bgAudio.addEventListener('ended', () => {
            bgAudio.currentTime = 2.38;
            bgAudio.volume = 0;
            bgAudio.play();
            const fadeIn = setInterval(() => {
                if (bgAudio.volume < 0.4) {
                    bgAudio.volume += 0.02;
                } else {
                    clearInterval(fadeIn);
                }
            }, 100);
        });
        function playHoverSound(filename) {
            if (!isAudioEnabled) return;
            let sfxFile;
            let playbackRate = 1.0;
            if (filename === 'codelab.json') {
                sfxFile = sfxMap['codeboogie.json'];
                playbackRate = 1.2;
            } else {
                sfxFile = sfxMap[filename] || "14830_2d4caf043407c875cd59c233a3915816_menu_generic_over.ogg";
            }
            const sound = new Audio(audioBaseUrl + sfxFile);
            sound.volume = 0.6;
            sound.playbackRate = playbackRate;
            sound.play().catch(e => {});
        }
        function openGameModal(url) {
            const modal = document.getElementById('game-modal');
            const iframe = document.getElementById('game-iframe');
            const fallbackLink = document.getElementById('fallback-link');
            iframe.src = url;
            fallbackLink.href = url;
            modal.classList.add('active');
            if(isAudioEnabled) {
                bgAudio.pause();
            }
        }
        function closeGameModal() {
            const modal = document.getElementById('game-modal');
            const iframe = document.getElementById('game-iframe');
            modal.classList.remove('active');
            iframe.src = "";
            if(isAudioEnabled) {
                bgAudio.volume = 0;
                bgAudio.play();
                let vol = 0;
                const fadeIn = setInterval(() => {
                    if (vol < 0.4) {
                        vol += 0.05;
                        bgAudio.volume = vol;
                    } else {
                        clearInterval(fadeIn);
                    }
                }, 100);
            }
        }
        const colors = [
            'bg-card-blue',
            'bg-card-green',
            'bg-card-red',
            'bg-card-yellow',
            'bg-card-purple',
            'bg-card-teal'
        ];
        const friendlyNames = {
            "santaselfie.json": "Santa Selfie",
            "codeboogie.json": "Code Boogie",
            "jetpack.json": "Elf Jetpack",
            "jamband.json": "Elf Jamband",
            "snowball.json": "Snowball Fight",
            "elfmaker.json": "Elf Maker",
            "codelab.json": "Code Lab",
            "wrapbattle.json": "Wrap Battle",
            "penguindash.json": "Penguin Dash",
            "buildandbolt.json": "Build & Bolt",
            "boatload.json": "Boat Load",
            "gumball.json": "Gumball",
            "presentbounce.json": "Present Bounce",
            "glider.json": "Elf Glider",
            "speedsketch.json": "Speed Sketch",
            "santascanvas.json": "Santa's Canvas",
            "seasonofgiving.json": "Season of Giving",
            "traditions.json": "Traditions",
            "santasearch.json": "Santa Search",
            "translations.json": "Translations",
            "runner.json": "Reindeer Runner",
            "snowbox.json": "Snowbox",
            "mercator.json": "Map Quiz",
            "windtunnel.json": "Wind Tunnel"
        };
        const files = Object.keys(friendlyNames);
        const container = document.getElementById('grid-container');
        const nowC = new Date();
        const currentMonth = nowC.getMonth();
        const currentDay = nowC.getDate();
        const isDecember = currentMonth === 11;
        files.forEach((file, index) => {
            const dayNumber = index + 1;
            let isLocked = true;
            if (currentMonth > 11) {
                isLocked = false;
            } else if (currentMonth === 11) {
                if (dayNumber <= currentDay) {
                    isLocked = false;
                }
            }
            const animationUrl = `${baseUrl}${file}`;
            const displayName = friendlyNames[file];
            const colorClass = isLocked ? 'bg-card-locked' : colors[index % colors.length];
            const pageName = file.replace('.json', '');
            const targetUrl = `${targetBaseUrl}${pageName}.html`;
            const card = document.createElement('div');
            card.className = `${colorClass} aspect-square rounded-3xl relative overflow-hidden ${isLocked ? '' : 'card-hover-effect cursor-pointer group'} select-none shadow-lg block no-underline`;
            let contentHtml = '';
            if (isLocked) {
                contentHtml = `
                    <div class="absolute inset-0 flex flex-col items-center justify-center p-4 z-20 locked-overlay">
                        <div class="bg-white/20 rounded-full p-4 mb-2 backdrop-blur-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-white/80" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                        </div>
                        <h2 class="text-4xl text-white/90 font-bold drop-shadow-lg">${dayNumber}</h2>
                        <span class="text-white/70 text-sm uppercase tracking-widest mt-1">Dec</span>
                    </div>
                `;
            } else {
                contentHtml = `
                    <div class="absolute top-3 left-4 z-20">
                        <span class="text-white/80 text-xl font-bold drop-shadow-md border-2 border-white/30 rounded-full w-8 h-8 flex items-center justify-center bg-white/10">${dayNumber}</span>
                    </div>
                    <div class="absolute inset-0 flex flex-col items-center justify-center p-4 pb-12">
                        <div class="absolute inset-0 flex items-center justify-center text-white/50 text-sm font-medium loading-text z-0">
                            Loading...
                        </div>
                        <lottie-player
                            src="${animationUrl}"
                            background="transparent"
                            speed="1"
                            style="width: 85%; height: 85%;"
                            class="relative z-10 transition-transform duration-500"
                        ></lottie-player>
                    </div>
                    <div class="absolute bottom-0 left-0 right-0 p-4 text-center z-20 bg-gradient-to-t from-black/20 to-transparent">
                        <h3 class="text-white text-xl tracking-wide text-shadow leading-tight">${displayName}</h3>
                    </div>
                    <div class="absolute top-3 right-3 opacity-0 group-hover:opacity-100 transition-opacity duration-300 z-30">
                        <div class="bg-white/20 backdrop-blur-sm rounded-full p-2">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>
                        </div>
                    </div>
                `;
                card.addEventListener('click', () => {
                    openGameModal(targetUrl);
                });
            }
            card.innerHTML = contentHtml;
            container.appendChild(card);
            if (!isLocked) {
                const player = card.querySelector('lottie-player');
                const loader = card.querySelector('.loading-text');
                player.addEventListener('ready', () => {
                    loader.style.display = 'none';
                    player.stop();
                });
                card.addEventListener('mouseenter', () => {
                    player.setDirection(1);
                    player.setSpeed(2);
                    player.play();
                    playHoverSound(file);
                });
                card.addEventListener('mouseleave', () => {
                    player.setDirection(-1);
                    player.setSpeed(2);
                    player.play();
                });
            }
        });
    </script>
</body>
</html>
